# Initial Admin Account Setup Guide

This guide provides step-by-step instructions for creating the first admin account in the Kirana Online Grocery App. This must be done before the app can be fully operational.

## Prerequisites

Before starting, ensure you have:
- ✅ Firebase project created and configured
- ✅ Cloud Firestore database created
- ✅ Firebase Authentication enabled (Phone provider)
- ✅ App deployed or ready for testing
- ✅ Access to Firebase Console
- ✅ Admin phone number ready (with SMS capability)

---

## Method 1: Firebase Console (Recommended)

This is the recommended method for creating the first admin account.

### Step 1: Register User via App

1. **Open the Kirana App** on your device or emulator
2. **Enter Admin Phone Number**: Use the phone number you want to designate as admin
3. **Receive and Enter OTP**: Complete the phone authentication
4. **Complete Registration**: Provide name and address if prompted
5. **Note the User ID**: You'll need this in the next step

**Finding User ID**:
- The user ID is automatically generated by Firebase Auth
- You can find it in Firebase Console → Authentication → Users
- It looks like: `abc123def456ghi789`

### Step 2: Set Admin Flag in Firestore

1. **Open Firebase Console**: https://console.firebase.google.com
2. **Select Your Project**: Choose the Kirana project
3. **Navigate to Firestore Database**:
   - Click "Firestore Database" in the left sidebar
   - You should see your collections

4. **Find the Customer Document**:
   - Click on the `customers` collection
   - Find the document with your user ID (from Step 1)
   - Click on the document to open it

5. **Add Admin Field**:
   - Click "Add field" button
   - Field name: `isAdmin`
   - Field type: `boolean`
   - Value: `true` (check the box)
   - Click "Add"

6. **Verify the Field**:
   - The document should now show `isAdmin: true`
   - All other fields should remain unchanged

### Step 3: Verify Admin Access

1. **Logout from App**: If already logged in, logout
2. **Login Again**: Use the same admin phone number
3. **Verify Admin Interface**:
   - You should see the Admin Dashboard instead of customer home
   - Navigation drawer should show admin options
   - You should have access to:
     - Manage Inventory
     - Manage Orders
     - Dashboard with stats

4. **Test Admin Functions**:
   - Try adding a product
   - Try viewing orders
   - Verify all admin features work

---

## Method 2: Firebase CLI (Advanced)

For advanced users comfortable with command line tools.

### Prerequisites
- Firebase CLI installed: `npm install -g firebase-tools`
- Logged in to Firebase: `firebase login`
- Project initialized: `firebase init firestore`

### Step 1: Create User via App
Same as Method 1, Step 1 - register the user through the app.

### Step 2: Update Firestore via CLI

Create a script file `create-admin.js`:

```javascript
const admin = require('firebase-admin');

// Initialize Firebase Admin SDK
admin.initializeApp({
  credential: admin.credential.applicationDefault(),
  projectId: 'your-project-id'
});

const db = admin.firestore();

async function createAdmin(userId) {
  try {
    // Update the customer document to set isAdmin flag
    await db.collection('customers').doc(userId).update({
      isAdmin: true
    });
    
    console.log(`Successfully set admin flag for user: ${userId}`);
  } catch (error) {
    console.error('Error setting admin flag:', error);
  }
}

// Replace with actual user ID
const userId = 'YOUR_USER_ID_HERE';
createAdmin(userId);
```

Run the script:
```bash
node create-admin.js
```

### Step 3: Verify Admin Access
Same as Method 1, Step 3.

---

## Method 3: Cloud Functions (Production)

For production environments, you can create a Cloud Function to set admin privileges.

### Create Admin Function

Create `functions/index.js`:

```javascript
const functions = require('firebase-functions');
const admin = require('firebase-admin');
admin.initializeApp();

// Secure this function with authentication
exports.setAdminRole = functions.https.onCall(async (data, context) => {
  // Verify the caller is already an admin (for subsequent admins)
  // For the first admin, you'll need to call this directly
  
  const userId = data.userId;
  
  if (!userId) {
    throw new functions.https.HttpsError(
      'invalid-argument',
      'User ID is required'
    );
  }
  
  try {
    // Set admin flag in Firestore
    await admin.firestore()
      .collection('customers')
      .doc(userId)
      .update({ isAdmin: true });
    
    return { success: true, message: `Admin role set for user ${userId}` };
  } catch (error) {
    throw new functions.https.HttpsError(
      'internal',
      'Error setting admin role',
      error
    );
  }
});
```

Deploy the function:
```bash
firebase deploy --only functions
```

Call the function (first time, use Firebase Console or curl):
```bash
curl -X POST \
  https://us-central1-your-project-id.cloudfunctions.net/setAdminRole \
  -H 'Content-Type: application/json' \
  -d '{"data": {"userId": "YOUR_USER_ID"}}'
```

---

## Creating Additional Admin Accounts

Once you have the first admin account, you can create additional admins:

### Option 1: Via Firebase Console
Follow Method 1 above for each new admin.

### Option 2: Via Admin Panel (Future Enhancement)
If you implement an admin user management feature in the app:
1. Login as existing admin
2. Navigate to user management
3. Find the user to promote
4. Set admin flag

### Option 3: Via Cloud Function
Use the Cloud Function from Method 3, but add authentication:
- Only existing admins can call the function
- Verify caller's admin status before setting new admin

---

## Security Considerations

### Important Security Notes

⚠️ **Admin Privileges are Powerful**:
- Admins can access all customer data
- Admins can modify all products and orders
- Admins can view sensitive information
- All admin actions are logged for audit

✅ **Best Practices**:
- Only create admin accounts for trusted personnel
- Use strong, unique phone numbers for admin accounts
- Never share admin credentials
- Regularly audit admin accounts
- Remove admin privileges when no longer needed
- Monitor admin activity logs

### Audit Logging

All admin actions are automatically logged. To view logs:

1. **Firebase Console** → **Firestore Database**
2. Navigate to `auditLogs` collection
3. Filter by `adminId` to see specific admin's actions
4. Review logs regularly for suspicious activity

### Revoking Admin Access

To remove admin privileges:

1. **Firebase Console** → **Firestore Database**
2. Navigate to `customers` collection
3. Find the admin user document
4. Change `isAdmin` field to `false`
5. User will lose admin access on next login

---

## Troubleshooting

### Issue: User Not Seeing Admin Interface

**Possible Causes**:
- `isAdmin` field not set correctly
- User hasn't logged out and back in
- App cache issue

**Solutions**:
1. Verify `isAdmin: true` in Firestore
2. Logout and login again
3. Clear app cache
4. Reinstall app (last resort)

### Issue: Cannot Find User in Firestore

**Possible Causes**:
- User hasn't completed registration
- User document not created
- Looking in wrong collection

**Solutions**:
1. Ensure user completed registration in app
2. Check `customers` collection (not `users`)
3. Search by phone number if needed
4. Check Firebase Authentication → Users for user ID

### Issue: Admin Field Not Saving

**Possible Causes**:
- Firestore security rules blocking write
- Insufficient permissions
- Network connectivity issue

**Solutions**:
1. Check Firestore security rules
2. Ensure you have owner/editor role in Firebase project
3. Try again with stable internet connection
4. Check Firebase Console for error messages

### Issue: Multiple Admins Needed

**Solution**:
Repeat the process for each admin user:
1. Have each person register via app
2. Set `isAdmin: true` for each user ID
3. Verify each admin can access admin features

---

## Verification Checklist

After creating the admin account, verify:

- [ ] User can login with admin phone number
- [ ] Admin Dashboard appears (not customer home)
- [ ] Can access "Manage Inventory"
- [ ] Can access "Manage Orders"
- [ ] Can add a new product
- [ ] Can edit an existing product
- [ ] Can upload product image
- [ ] Can view all orders
- [ ] Can update order status
- [ ] Can see dashboard statistics
- [ ] Navigation drawer shows admin options
- [ ] No access to customer-only features

---

## Initial Setup Workflow

Recommended workflow for first-time setup:

### 1. Create Admin Account
- Follow Method 1 above
- Verify admin access works

### 2. Add Initial Products
- Login as admin
- Navigate to Inventory Management
- Add 5-10 initial products with:
  - Clear product names
  - Accurate prices
  - Appropriate categories
  - Stock quantities
  - Product images

### 3. Test Customer Flow
- Logout from admin account
- Register as a test customer
- Browse products
- Add items to cart
- Place a test order

### 4. Test Order Management
- Login as admin
- View the test order
- Update order status
- Verify customer receives notifications

### 5. Configure Settings
- Set up Firebase alerts
- Configure backup schedule
- Review security rules
- Set up monitoring

---

## Admin Account Information Template

Keep a secure record of admin accounts:

```
Admin Account #1
----------------
Name: _______________
Phone: _______________
User ID: _______________
Created Date: _______________
Created By: _______________
Role: Primary Admin
Notes: _______________

Admin Account #2
----------------
Name: _______________
Phone: _______________
User ID: _______________
Created Date: _______________
Created By: _______________
Role: Secondary Admin
Notes: _______________
```

**Security Note**: Store this information securely, not in version control.

---

## Next Steps

After creating the admin account:

1. **Review Documentation**:
   - Read Admin User Guide
   - Review Deployment Guide
   - Understand troubleshooting procedures

2. **Configure Monitoring**:
   - Set up Firebase alerts
   - Configure budget alerts
   - Enable performance monitoring

3. **Add Initial Data**:
   - Add product catalog
   - Set up categories
   - Configure settings

4. **Test Thoroughly**:
   - Test all admin features
   - Test customer flow
   - Verify notifications
   - Check order processing

5. **Train Team**:
   - Train other admins
   - Document custom procedures
   - Set up support processes

---

## Support

If you encounter issues during admin setup:

1. **Check Troubleshooting Section** above
2. **Review Firebase Console** for errors
3. **Check Firestore Security Rules** for access issues
4. **Verify Firebase Authentication** is working
5. **Contact Technical Support** if issues persist

---

**Admin account setup is complete! You can now manage the Kirana platform.**
